# ═══════════════════════════════════════════════════════════════════════════════
# T84.5: High-Throughput Devnet Profile (max-perf, single node, laptop)
# ═══════════════════════════════════════════════════════════════════════════════
#
# This configuration captures the "plateau" of T82–T84 performance work:
#   T82.x: STM metrics, overlay, conflict prescreen, mempool actor
#   T83.0: sigpool micro-batching + metrics
#   T83.1: multi-sender spam generator
#   T83.2: async persistence (CommittedMemHead + PersistenceWorker)
#   T83.3: block execution pipelining (BlockPipeline)
#   T83.4: zero-copy SharedTx propagation
#   T84.0: lazy/incremental state root
#   T87.x: Deep performance pass (aggressive wave grouping, allocation reduction)
#
# Expected TPS range: ~150–250 TPS depending on workload and hardware.
#
# Usage:
#   source devnet_tps.env
#   ./scripts/devnet_dag_primary.sh
#
# Or run directly with env file sourced:
#   set -a && source devnet_tps.env && set +a
#   cargo run -p eezo-node --bin eezo-node \
#     --features "devnet-safe,metrics,pq44-runtime,checkpoints,stm-exec,dag-consensus" -- \
#     --genesis genesis.min.json \
#     --datadir /tmp/eezo-t84
#
# See book/src/t84_plateau.md for full documentation.
# See book/src/t87_deep_perf.md for T87.x deep performance pass.
# ═══════════════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────────────
# Core Consensus Mode
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_CONSENSUS_MODE=dag-primary

# ───────────────────────────────────────────────────────────────────────────────
# T82.4: Mempool Actor (enabled for better admission control)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_MEMPOOL_ACTOR_ENABLED=1

# ───────────────────────────────────────────────────────────────────────────────
# T83.2: Async Persistence (decouple RocksDB from critical path)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_PERSIST_ASYNC=1

# ───────────────────────────────────────────────────────────────────────────────
# T83.3: Block Execution Pipelining (overlap execution with proposal)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_PIPELINE_ENABLED=1

# ───────────────────────────────────────────────────────────────────────────────
# T84.0: Lazy/Incremental State Root (defer recompute until needed)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_LAZY_STATE_ROOT=1

# ───────────────────────────────────────────────────────────────────────────────
# STM Executor Configuration (T73/T76/T82)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_EXEC_LANES=32
export EEZO_EXEC_WAVE_CAP=256

# ───────────────────────────────────────────────────────────────────────────────
# T87.x: Deep Performance Pass (aggressive wave grouping)
# ───────────────────────────────────────────────────────────────────────────────
# Enable aggressive wave grouping for better parallelism with disjoint senders.
# This is opt-in and safe for production; it only affects wave construction
# heuristics, not correctness.
export EEZO_STM_WAVE_AGGRESSIVE=1

# ───────────────────────────────────────────────────────────────────────────────
# Sigpool Configuration (T83.0)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_SIGPOOL_THREADS=4
export EEZO_SIGPOOL_BATCH_SIZE=128
export EEZO_SIGPOOL_QUEUE=20000

# ───────────────────────────────────────────────────────────────────────────────
# Mempool Configuration (generous limits for TPS tests)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_MEMPOOL_MAX_LEN=50000

# ───────────────────────────────────────────────────────────────────────────────
# Block Production
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_BLOCK_MAX_TX=500
export EEZO_BLOCK_TARGET_TIME_MS=1000

# ───────────────────────────────────────────────────────────────────────────────
# Data Directory (default for TPS tests)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_DATADIR=/tmp/eezo-t84

# ───────────────────────────────────────────────────────────────────────────────
# Network Bindings (localhost for local development)
# ───────────────────────────────────────────────────────────────────────────────
export EEZO_LISTEN=127.0.0.1:8080
export EEZO_METRICS_BIND=127.0.0.1:9898
